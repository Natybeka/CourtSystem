<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Court_system</title>
    <link rel="stylesheet" href="../Assets/css/bootstrap.min.css" >
    <link rel="stylesheet" href="../Assets/css/End_user_style.css" >
    <link href="https://fonts.googleapis.com/css?family=Baloo+Thambi+2&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script type = "text/javascript" >  
      function preventBack() { window.history.forward(); }  
      setTimeout("preventBack()", 0);  
      // window.onunload = function () { null };  
    </script>
    
    <script>
        // extract user key from url resource key to access database
        const url = new URLSearchParams(window.location.search);
        let userName;
        if (sessionStorage.length == 0) {
          userName = url.get("user");
          sessionStorage.setItem('user',userName);
        }
        else {
          userName = sessionStorage.getItem('user');
        }
        
        console.log(userName);

        document.addEventListener('DOMContentLoaded', () => {
            const caseContainer = document.querySelector("#case-container");
            const welcome = document.querySelector("#welcome-header");    

            welcome.innerHTML = "Welcome " + userName + ", get on top of your active cases today";
            welcome.style.fontSize = "2rem";
            // Open the database
            let courtDB;
            let court = indexedDB.open("CourtSystem", 1);
            court.onsuccess = function(e) {
                courtDB = e.target.result;
                let userCases = courtDB.transaction("Cases").objectStore("Cases");
                
                let plaintiffIndex = userCases.index("by_plaintiff");
                let defendantIndex = userCases.index("by_defendant");

                

                let requestPlaintiff = plaintiffIndex.getAll(userName);
                let requestDefendant = defendantIndex.getAll(userName);
                requestPlaintiff.onsuccess = function() {
                    if (requestPlaintiff.result != undefined) {
                        let activeCases = requestPlaintiff.result;
                        let userView = '';
                        userView += `<div class="row"> <div class="col-sm-12"><h1 style="color:#bda35c">Filed Cases</h1></div> </div>`
                        activeCases.forEach(item => {
                            userView += `
                            <div class="row">
                                        <div class="card col-sm-12">
                                            <div class="card-body">
                                                <h5 class="card-title"> Case Title: ${item.plaintiff + " Vs " + item.defendant}</h5>
                                                <h6 class="card-subtitle mb-2">Case Number: ${item.caseID}</h6>
                                                <p class="card-text lead">${item.description}</p>
                                                <a href="" class="btn btn-primary">See Detail</a>
                                            </div>
                                        </div>
                            </div>                       
                            `
                        });
                        const parentDiv = document.createElement("div");
                        parentDiv.className = "container";
                        parentDiv.innerHTML = userView;
                        caseContainer.appendChild(parentDiv);
                                     
                    }
                    else {
                        console.log("User is not a plaintiff in any cases")
                    }
                }

                requestDefendant.onsuccess = function() {
                    if (requestDefendant.result != undefined) {
                        let activeCases = requestDefendant.result;
                        let userView = '';
                        userView += `<div class="row"> <div class="col-sm-12"><h1 style="color:#b53d35">Filed Against Cases</h1></div> </div>`
                        activeCases.forEach(item => {
                            userView += `
                            <div class="row">
                                        <div class="card col-sm-12">
                                            <div class="card-body">
                                                <h5 class="card-title"> Case Title: ${item.plaintiff + " Vs " + item.defendant}</h5>
                                                <h6 class="card-subtitle mb-2">Case Number: ${item.caseID}</h6>
                                                <p class="card-text lead">${item.description}</p>
                                                <a href="" class="btn btn-primary">See Detail</a>
                                            </div>
                                        </div>
                            </div>                       
                            `
                        });
                        const parentDiv = document.createElement("div");
                        parentDiv.className = "container";
                        parentDiv.innerHTML = userView;
                        caseContainer.appendChild(parentDiv);               
                    }
                    else {
                        console.log("User is not a defendant in any cases")
                    }
                }
            } 
            
        });

        // function clearSession(){
        //   sessionStorage.clear();
        // }
        
    </script>

</head>
<body>
  <header class="container mt-4"  id="welcome-header"> </header>
<div class="container" id="nav-container">
  <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
    <a class="navbar-brand" href="#">
        <i class="fa fa-balance-scale fa-lg"></i>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item ">
            <a class="nav-link active" href="#">MY CASES</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./Request.html">FILE REQUEST</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="./public_record.html">PUBLIC RECORDS</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../index.html" onfocus="clearSession()">LOG OUT</a>
            </li>
        
      </ul>
    </div>
  </nav>

  </div>


    <!-- populate the data from DB here -->
  <div class="container "  id="case-container">
      <!-- place cards here -->

  </div>
 
 
 
 
 
 
 
 
 
 
 
 
  <!-- <div class="card">
    <div class="card-body">
      <h5 class="card-title">Case Name</h5>
      <h6 class="card-subtitle mb-2 text-muted">Case Number</h6>
      <p class="card-text">This case is Lorem ipsum dolor sit amet consectetur adipisicing elit. Nesciunt iusto at velit eos,
           qui aspernatur nisi? Exercitationem totam dicta deleniti, dolor et recusandae laudantium itaque? Molestias commodi minus 
          consectetur vero. fnkvfdj Lorem ipsum dolor sit amet consectetur adipisicing elit. Nihil sed voluptatum animi, totam at 
          error maiores optio magnam debitis quod? Sunt sit deserunt dolores exercitationem explicabo maiores dignissimos id. Impedit.</p>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">Status : completed</li>
            <li class="list-group-item"><a href="#" class="card-link">Details</a></li>
          </ul>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Case Name</h5>
      <h6 class="card-subtitle mb-2 text-muted">Case Number</h6>
      <p class="card-text">This case is Lorem ipsum dolor sit amet consectetur adipisicing elit. Nesciunt iusto at velit eos,
           qui aspernatur nisi? Exercitationem totam dicta deleniti, dolor et recusandae laudantium itaque? Molestias commodi minus 
          consectetur vero. fnkvfdj Lorem ipsum dolor sit amet consectetur adipisicing elit. Nihil sed voluptatum animi, totam at 
          error maiores optio magnam debitis quod? Sunt sit deserunt dolores exercitationem explicabo maiores dignissimos id. Impedit.</p>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">Status : completed</li>
            <li class="list-group-item"><a href="#" class="card-link">Details</a></li>
          </ul>
    </div>
  </div> -->

  <footer class="bg-light sticky-bottom container">
    <div class="row px-4 fo-row">
      <div class="copy_right">
        <p>@2021. All rights reserved</p>
      </div>
    </div>
   </footer>

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="../Assets/js/bootstrap.min.js" ></script>
    <script src="../Assets/js/clearSession.js"></script>
  </body>
</html>